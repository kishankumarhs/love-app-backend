version: '3.8'\n\nservices:\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgresql://postgres:password@db:5432/loveapp\n      - JWT_SECRET=your-jwt-secret\n      - STRIPE_SECRET_KEY=sk_test_your_stripe_key\n      - TWILIO_ACCOUNT_SID=your_twilio_sid\n      - TWILIO_AUTH_TOKEN=your_twilio_token\n      - EMAIL_HOST=smtp.gmail.com\n      - EMAIL_USER=your-email@gmail.com\n      - EMAIL_PASS=your-app-password\n    depends_on:\n      - db\n      - redis\n    volumes:\n      - ./uploads:/app/uploads\n    restart: unless-stopped\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_DB=loveapp\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=password\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./src/migrations:/docker-entrypoint-initdb.d\n    restart: unless-stopped\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis_data:/data\n    restart: unless-stopped\n\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf\n      - ./ssl:/etc/nginx/ssl\n    depends_on:\n      - app\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n  redis_data:\n